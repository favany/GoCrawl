<div class="article">            <div class="inner">              <header class="article-header">                <h1 class="article-title" itemprop="name">GORM 配置</h1>                                <a href="https://translate.gorm.io/project/go-gorm/zh-CN" target="_blank" rel="noopener" class="article-edit-link" title="改进此页面"><i class="fa fa-pencil"></i></a>                              </header>              <div class="article-content" itemprop="articleBody">                <html><head></head><body><p>GORM 提供的配置可以在初始化时使用</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> {</span><br><span class="line">  SkipDefaultTransaction   <span class="keyword">bool</span></span><br><span class="line">  NamingStrategy           schema.Namer</span><br><span class="line">  Logger                   logger.Interface</span><br><span class="line">  NowFunc                  <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">time</span>.<span class="title">Time</span></span></span><br><span class="line">  DryRun                   <span class="keyword">bool</span></span><br><span class="line">  PrepareStmt              <span class="keyword">bool</span></span><br><span class="line">  DisableNestedTransaction <span class="keyword">bool</span></span><br><span class="line">  AllowGlobalUpdate        <span class="keyword">bool</span></span><br><span class="line">  DisableAutomaticPing     <span class="keyword">bool</span></span><br><span class="line">  DisableForeignKeyConstraintWhenMigrating <span class="keyword">bool</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><h2 id="跳过默认事务" class="article-heading"><a href="#跳过默认事务" class="headerlink" title="跳过默认事务"></a>跳过默认事务<a class="article-anchor" href="#跳过默认事务" aria-hidden="true"></a></h2><p>为了确保数据一致性，GORM 会在事务里执行写入操作（创建、更新、删除）。如果没有这方面的要求，您可以在初始化时禁用它。</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{</span><br><span class="line">  SkipDefaultTransaction: <span class="literal">true</span>,</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><h2 id="命名策略" class="article-heading"><a href="#命名策略" class="headerlink" title="命名策略"></a><span id="naming_strategy">命名策略</span><a class="article-anchor" href="#命名策略" aria-hidden="true"></a></h2><p>GORM 允许用户通过覆盖默认的<code>NamingStrategy</code>来更改命名约定，这需要实现接口 <code>Namer</code></p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Namer <span class="keyword">interface</span> {</span><br><span class="line">    TableName(table <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">    SchemaName(table <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">    ColumnName(table, column <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">    JoinTableName(table <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">    RelationshipFKName(Relationship) <span class="keyword">string</span></span><br><span class="line">    CheckerName(table, column <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">    IndexName(table, column <span class="keyword">string</span>) <span class="keyword">string</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><p>默认 <code>NamingStrategy</code> 也提供了几个选项，如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{</span><br><span class="line">  NamingStrategy: schema.NamingStrategy{</span><br><span class="line">    TablePrefix: <span class="string">"t_"</span>,   <span class="comment">// table name prefix, table for `User` would be `t_users`</span></span><br><span class="line">    SingularTable: <span class="literal">true</span>, <span class="comment">// use singular table name, table for `User` would be `user` with this option enabled</span></span><br><span class="line">    NoLowerCase: <span class="literal">true</span>, <span class="comment">// skip the snake_casing of names</span></span><br><span class="line">    NameReplacer: strings.NewReplacer(<span class="string">"CID"</span>, <span class="string">"Cid"</span>), <span class="comment">// use name replacer to change struct/field name before convert it to db name</span></span><br><span class="line">  },</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><h2 id="Logger" class="article-heading"><a href="#Logger" class="headerlink" title="Logger"></a>Logger<a class="article-anchor" href="#Logger" aria-hidden="true"></a></h2><p>允许通过覆盖此选项更改 GORM 的默认 logger，参考 <a href="logger.html">Logger</a> 获取详情</p><h2 id="NowFunc" class="article-heading"><a href="#NowFunc" class="headerlink" title="NowFunc"></a><span id="now_func">NowFunc</span><a class="article-anchor" href="#NowFunc" aria-hidden="true"></a></h2><p>更改创建时间使用的函数</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{</span><br><span class="line">  NowFunc: <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">time</span>.<span class="title">Time</span></span> {</span><br><span class="line">    <span class="keyword">return</span> time.Now().Local()</span><br><span class="line">  },</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><h2 id="DryRun" class="article-heading"><a href="#DryRun" class="headerlink" title="DryRun"></a>DryRun<a class="article-anchor" href="#DryRun" aria-hidden="true"></a></h2><p>生成 <code>SQL</code> 但不执行，可以用于准备或测试生成的 SQL，参考 <a href="session.html">会话</a> 获取详情</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{</span><br><span class="line">  DryRun: <span class="literal">false</span>,</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><h2 id="PrepareStmt" class="article-heading"><a href="#PrepareStmt" class="headerlink" title="PrepareStmt"></a>PrepareStmt<a class="article-anchor" href="#PrepareStmt" aria-hidden="true"></a></h2><p><code>PreparedStmt</code> 在执行任何 SQL 时都会创建一个 prepared statement 并将其缓存，以提高后续的效率，参考 <a href="session.html">会话</a> 获取详情</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{</span><br><span class="line">  PrepareStmt: <span class="literal">false</span>,</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><h2 id="禁用嵌套事务" class="article-heading"><a href="#禁用嵌套事务" class="headerlink" title="禁用嵌套事务"></a>禁用嵌套事务<a class="article-anchor" href="#禁用嵌套事务" aria-hidden="true"></a></h2><p>在一个事务中使用 <code>Transaction</code> 方法，GORM 会使用 <code>SavePoint(savedPointName)</code>，<code>RollbackTo(savedPointName)</code> 为你提供嵌套事务支持，你可以通过 <code>DisableNestedTransaction</code> 选项关闭它，查看 <a href="session.html">Session</a> 获取详情</p><h2 id="AllowGlobalUpdate" class="article-heading"><a href="#AllowGlobalUpdate" class="headerlink" title="AllowGlobalUpdate"></a>AllowGlobalUpdate<a class="article-anchor" href="#AllowGlobalUpdate" aria-hidden="true"></a></h2><p>启用全局 update/delete，查看 <a href="session.html">Session</a> 获取详情</p><h2 id="DisableAutomaticPing" class="article-heading"><a href="#DisableAutomaticPing" class="headerlink" title="DisableAutomaticPing"></a>DisableAutomaticPing<a class="article-anchor" href="#DisableAutomaticPing" aria-hidden="true"></a></h2><p>在完成初始化后，GORM 会自动 ping 数据库以检查数据库的可用性，若要禁用该特性，可将其设置为 <code>true</code></p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{</span><br><span class="line">  DisableAutomaticPing: <span class="literal">true</span>,</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><h2 id="DisableForeignKeyConstraintWhenMigrating" class="article-heading"><a href="#DisableForeignKeyConstraintWhenMigrating" class="headerlink" title="DisableForeignKeyConstraintWhenMigrating"></a>DisableForeignKeyConstraintWhenMigrating<a class="article-anchor" href="#DisableForeignKeyConstraintWhenMigrating" aria-hidden="true"></a></h2><p>在 <code>AutoMigrate</code> 或 <code>CreateTable</code> 时，GORM 会自动创建外键约束，若要禁用该特性，可将其设置为 <code>true</code>，参考 <a href="migration.html">迁移</a> 获取详情。</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"gorm.db"</span>), &amp;gorm.Config{</span><br><span class="line">  DisableForeignKeyConstraintWhenMigrating: <span class="literal">true</span>,</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure></body></html>              </div>