<div class="article">            <div class="inner">              <header class="article-header">                <h1 class="article-title" itemprop="name">Logger</h1>                                <a href="https://translate.gorm.io/project/go-gorm/zh-CN" target="_blank" rel="noopener" class="article-edit-link" title="改进此页面"><i class="fa fa-pencil"></i></a>                              </header>              <div class="article-content" itemprop="articleBody">                <html><head></head><body><h2 id="Logger" class="article-heading"><a href="#Logger" class="headerlink" title="Logger"></a>Logger<a class="article-anchor" href="#Logger" aria-hidden="true"></a></h2><p>Gorm 有一个 <a href="https://github.com/go-gorm/gorm/blob/master/logger/logger.go" target="_blank" rel="noopener">默认 logger 实现</a>，默认情况下，它会打印慢 SQL 和错误</p><p>Logger 接受的选项不多，您可以在初始化时自定义它，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">newLogger := logger.New(</span><br><span class="line">  log.New(os.Stdout, <span class="string">"\r\n"</span>, log.LstdFlags), <span class="comment">// io writer（日志输出的目标，前缀和日志包含的内容——译者注）</span></span><br><span class="line">  logger.Config{</span><br><span class="line">    SlowThreshold: time.Second,   <span class="comment">// 慢 SQL 阈值</span></span><br><span class="line">    LogLevel:      logger.Silent, <span class="comment">// 日志级别</span></span><br><span class="line">    IgnoreRecordNotFoundError: <span class="literal">true</span>,   <span class="comment">// 忽略ErrRecordNotFound（记录未找到）错误</span></span><br><span class="line">    Colorful:      <span class="literal">false</span>,         <span class="comment">// 禁用彩色打印</span></span><br><span class="line">  },</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 全局模式</span></span><br><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"test.db"</span>), &amp;gorm.Config{</span><br><span class="line">  Logger: newLogger,</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">// 新建会话模式</span></span><br><span class="line">tx := db.Session(&amp;Session{Logger: newLogger})</span><br><span class="line">tx.First(&amp;user)</span><br><span class="line">tx.Model(&amp;user).Update(<span class="string">"Age"</span>, <span class="number">18</span>)</span><br></pre></td></tr></tbody></table></figure><h3 id="日志级别" class="article-heading"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别<a class="article-anchor" href="#日志级别" aria-hidden="true"></a></h3><p>GORM 定义了这些日志级别：<code>Silent</code>、<code>Error</code>、<code>Warn</code>、<code>Info</code></p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db, err := gorm.Open(sqlite.Open(<span class="string">"test.db"</span>), &amp;gorm.Config{</span><br><span class="line">  Logger: logger.Default.LogMode(logger.Silent),</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure><h3 id="Debug" class="article-heading"><a href="#Debug" class="headerlink" title="Debug"></a>Debug<a class="article-anchor" href="#Debug" aria-hidden="true"></a></h3><p>Debug 单个操作，将当前操作的 log 级别调整为 logger.Info</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line">db.Debug().Where(<span class="string">"name = ?"</span>, <span class="string">"jinzhu"</span>).First(&amp;User{})</span><br></pre></td></tr></tbody></table></figure><h2 id="自定义-Logger" class="article-heading"><a href="#自定义-Logger" class="headerlink" title="自定义 Logger"></a>自定义 Logger<a class="article-anchor" href="#自定义-Logger" aria-hidden="true"></a></h2><p>参考 GORM 的 <a href="https://github.com/go-gorm/gorm/blob/master/logger/logger.go" target="_blank" rel="noopener">默认 logger</a> 来定义您自己的 logger</p><p>Logger 需要实现以下接口，它接受 <code>context</code>，所以你可以用它来追踪日志</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> {</span><br><span class="line">    LogMode(LogLevel) Interface</span><br><span class="line">    Info(context.Context, <span class="keyword">string</span>, ...<span class="keyword">interface</span>{})</span><br><span class="line">    Warn(context.Context, <span class="keyword">string</span>, ...<span class="keyword">interface</span>{})</span><br><span class="line">    Error(context.Context, <span class="keyword">string</span>, ...<span class="keyword">interface</span>{})</span><br><span class="line">    Trace(ctx context.Context, begin time.Time, fc <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="params">(sql <span class="keyword">string</span>, rowsAffected <span class="keyword">int64</span>)</span>, <span class="title">err</span> <span class="title">error</span>)</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></body></html>              </div>