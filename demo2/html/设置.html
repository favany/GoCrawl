<div class="article">            <div class="inner">              <header class="article-header">                <h1 class="article-title" itemprop="name">设置</h1>                                <a href="https://translate.gorm.io/project/go-gorm/zh-CN" target="_blank" rel="noopener" class="article-edit-link" title="改进此页面"><i class="fa fa-pencil"></i></a>                              </header>              <div class="article-content" itemprop="articleBody">                <html><head></head><body><p>GORM 提供了 <code>Set</code>, <code>Get</code>, <code>InstanceSet</code>, <code>InstanceGet</code> 方法来允许用户传值给 <a href="hooks.html">勾子</a> 或其他方法</p><p>Gorm 中有一些特性用到了这种机制，如迁移表格时传递表格选项。</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// 创建表时添加表后缀</span></span><br><span class="line">db.Set(<span class="string">"gorm:table_options"</span>, <span class="string">"ENGINE=InnoDB"</span>).AutoMigrate(&amp;User{})</span><br></pre></td></tr></tbody></table></figure><h2 id="Set-Get" class="article-heading"><a href="#Set-Get" class="headerlink" title="Set / Get"></a>Set / Get<a class="article-anchor" href="#Set-Get" aria-hidden="true"></a></h2><p>使用 <code>Set</code> / <code>Get</code> 传递设置到钩子方法，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  CreditCard CreditCard</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">BeforeCreate</span><span class="params">(tx *gorm.DB)</span> <span class="title">error</span></span> {</span><br><span class="line">  myValue, ok := tx.Get(<span class="string">"my_value"</span>)</span><br><span class="line">  <span class="comment">// ok =&gt; true</span></span><br><span class="line">  <span class="comment">// myValue =&gt; 123</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CreditCard <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(card *CreditCard)</span> <span class="title">BeforeCreate</span><span class="params">(tx *gorm.DB)</span> <span class="title">error</span></span> {</span><br><span class="line">  myValue, ok := tx.Get(<span class="string">"my_value"</span>)</span><br><span class="line">  <span class="comment">// ok =&gt; true</span></span><br><span class="line">  <span class="comment">// myValue =&gt; 123</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">myValue := <span class="number">123</span></span><br><span class="line">db.Set(<span class="string">"my_value"</span>, myValue).Create(&amp;User{})</span><br></pre></td></tr></tbody></table></figure><h2 id="InstanceSet-InstanceGet" class="article-heading"><a href="#InstanceSet-InstanceGet" class="headerlink" title="InstanceSet / InstanceGet"></a>InstanceSet / InstanceGet<a class="article-anchor" href="#InstanceSet-InstanceGet" aria-hidden="true"></a></h2><p>使用 <code>InstanceSet</code> / <code>InstanceGet</code> 传递设置到 <code>*Statement</code> 的钩子方法，例如：</p><figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  CreditCard CreditCard</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">BeforeCreate</span><span class="params">(tx *gorm.DB)</span> <span class="title">error</span></span> {</span><br><span class="line">  myValue, ok := tx.InstanceGet(<span class="string">"my_value"</span>)</span><br><span class="line">  <span class="comment">// ok =&gt; true</span></span><br><span class="line">  <span class="comment">// myValue =&gt; 123</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> CreditCard <span class="keyword">struct</span> {</span><br><span class="line">  gorm.Model</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在创建关联时，GORM 创建了一个新 `*Statement`，所以它不能读取到其它实例的设置</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(card *CreditCard)</span> <span class="title">BeforeCreate</span><span class="params">(tx *gorm.DB)</span> <span class="title">error</span></span> {</span><br><span class="line">  myValue, ok := tx.InstanceGet(<span class="string">"my_value"</span>)</span><br><span class="line">  <span class="comment">// ok =&gt; false</span></span><br><span class="line">  <span class="comment">// myValue =&gt; nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">myValue := <span class="number">123</span></span><br><span class="line">db.InstanceSet(<span class="string">"my_value"</span>, myValue).Create(&amp;User{})</span><br></pre></td></tr></tbody></table></figure></body></html>              </div>